# Picom with Low Opacity and Blur Effects
# Save as ~/.config/picom/picom.conf

backend = "glx";
vsync = true;

# Keep fading enabled for smooth opacity transitions
fading = true;
fade-delta = 8;
fade-in-step = 0.05;
fade-out-step = 0.05;

# Shadows for depth
shadow = true;
shadow-radius = 18;
shadow-opacity = 0.4;
shadow-offset-x = -8;
shadow-offset-y = -8;

shadow-exclude = [
    "name = 'Notification'",
    "class_g = 'Conky'",
    "class_g ?= 'Notify-osd'",
    "_GTK_FRAME_EXTENTS@:c",
    "class_g = 'Polybar'"  # Added Polybar to shadow exclusions
];

# ======================
# LOW OPACITY SETTINGS
# ======================

# Main opacity settings - LOW values for transparent effect
inactive-opacity = 0.7;        # Inactive windows
active-opacity = 0.9;          # Active window
frame-opacity = 0.8;           # Window borders
popup_menu-opacity = 0.85;     # Popup menus
dropdown_menu-opacity = 0.85;  # Dropdown menus

# Opacity rules for specific applications
opacity-rule = [
    # Terminal transparency
    "80:class_g = 'Alacritty'",
    "50:class_g = 'kitty'",
    "80:class_g = 'URxvt'",
    "50:class_g = 'XTerm'",

    # Browser transparency
    "95:class_g = 'firefox'",
    "95:class_g = 'Chromium'",
    "95:class_g = 'Google-chrome'",

    # File managers
    "85:class_g = 'Thunar'",
    "85:class_g = 'Nautilus'",
    "85:class_g = 'dolphin'",

    # Keep some windows fully opaque
    "100:class_g = 'mpv'",
    "100:class_g = 'vlc'",
    "100:class_g = 'Gimp'",
    "100:class_g = 'kdenlive'",
    "100:class_g = 'OBS'",

    # ADD THIS LINE - Force Polybar to be 100% opaque
    "70:class_g = 'Polybar'"
];

# ======================
# HEAVY BLUR SETTINGS
# ======================

# Strong blur effect
blur: {
    method = "dual_kawase";
    strength = 12;              # Increased blur strength
    background = true;          # Blur behind windows
    background-frame = true;    # Blur behind window frames
    background-fixed = false;   # Don't freeze blur background
    kernel = "5x5box";          # Blur kernel type
}

# Blur exclusion list
blur-background-exclude = [
    # Don't blur these elements
    "window_type = 'dock'",
    "window_type = 'desktop'",
    "window_type = 'tooltip'",
    "_GTK_FRAME_EXTENTS@:c",

    # Don't blur specific applications
    "class_g = 'Steam'",
    "class_g = 'dragon-drop'",
    "class_g = 'Xephyr'",

    # Don't blur media players
    "class_g = 'mpv'",
    "class_g = 'vlc'",

    # Don't blur creative apps
    "class_g = 'Gimp'",
    "class_g = 'kdenlive'",
    "class_g = 'OBS'",

    # Don't blur gaming apps
    "class_g = 'lutris'",
    "class_g = 'heroic'",

    # ADD THIS LINE - Exclude Polybar from blur effects
    "class_g = 'Polybar'"
];

# Rounded corners with transparency
corner-radius = 12;
rounded-corners-exclude = [
    "window_type = 'dock'",
    "window_type = 'desktop'",
    "class_g = 'Polybar'",
    "class_g = 'i3bar'"
];

# ======================
# ANIMATIONS (Optional)
# ======================
animations = true;

# Smooth animations for opacity changes
animation-for-open-window = "zoom";
animation-for-close-window = "zoom";

animation-open = {
    duration = 0.3;
    curve = "easeOutQuad";
    animation = "zoom";
};

animation-close = {
    duration = 0.25;
    curve = "easeInQuad";
    animation = "zoom";
};

# Exclude certain windows from animations
animation-exclude = [
    "class_g = 'Steam'",
    "class_g = 'mpv'",
    "class_g = 'vlc'",
    "class_g = 'OBS'",
    "class_g = 'Polybar'"  # Added Polybar to animation exclusions
];

# ======================
# ADVANCED BLUR OPTIONS
# ======================

# Experimental: Multi-layer blur (if supported)
blur-background = true;
blur-background-frame = true;
blur-kern = "3x3box";

# Blur method options:
# "none", "kernel", "box", "gaussian", "dual_kawase", "kawase"
blur-method = "dual_kawase";

# Blur strength per method
blur-strength = 12;           # For dual_kawase (higher = more blur)
blur-size = 12;               # For kernel methods
blur-deviation = 5.0;         # For gaussian blur

# ======================
# OTHER SETTINGS
# ======================

detect-client-opacity = true;
mark-ovredir-focused = true;
detect-rounded-corners = true;
xrender-sync-fence = true;

# Window type settings
wintypes: {
    tooltip = {
        fade = true;
        shadow = true;
        opacity = 0.9;
        blur-background = false;
    };
    dock = {
        shadow = false;
        opacity = 0.8;
        blur-background = false;
    };
    dnd = {
        shadow = false;
        opacity = 0.9;
        blur-background = false;
    };
    popup_menu = {
        opacity = 0.9;
        blur-background = true;
    };
    dropdown_menu = {
        opacity = 0.9;
        blur-background = true;
    };
};
